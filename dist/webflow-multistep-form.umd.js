!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).WebflowMultiStepForm={})}(this,(function(t){"use strict";class e{constructor(t){this.form=t,this.steps=Array.from(this.form.querySelectorAll("[data-form-step]")),this.currentStepIndex=0,this.totalSteps=this.steps.length}getCurrentStep(){return this.steps[this.currentStepIndex]}getCurrentStepIndex(){return this.currentStepIndex}getTotalSteps(){return this.totalSteps}goToStep(t){return t>=0&&t<this.totalSteps&&(this.currentStepIndex=t,this.updateStepStates(),!0)}next(){return this.goToStep(this.currentStepIndex+1)}previous(){return this.goToStep(this.currentStepIndex-1)}hasNext(){return this.currentStepIndex<this.totalSteps-1}hasPrevious(){return this.currentStepIndex>0}updateStepStates(){this.steps.forEach(((t,e)=>{t.removeAttribute("data-form-step-active"),t.removeAttribute("data-form-step-completed"),t.removeAttribute("data-form-step-upcoming"),e===this.currentStepIndex?(t.setAttribute("data-form-step-active",""),t.style.display="block"):e<this.currentStepIndex?(t.setAttribute("data-form-step-completed",""),t.style.display="none"):(t.setAttribute("data-form-step-upcoming",""),t.style.display="none")})),this.form.setAttribute("data-form-step-index",this.currentStepIndex),this.form.setAttribute("data-form-step-count",this.totalSteps),this.form.dispatchEvent(new CustomEvent("stepChange",{detail:{currentStep:this.currentStepIndex,totalSteps:this.totalSteps,isFirstStep:!this.hasPrevious(),isLastStep:!this.hasNext()}}))}}class s{constructor(t){this.form=t,this.formId=this.form.id,this.storageKey=`wf-form-${this.formId}`,this.autoSaveInterval=null,this.handleInput=this.handleInput.bind(this),this.saveProgress=this.saveProgress.bind(this),this.restoreProgress=this.restoreProgress.bind(this)}init(){this.form.addEventListener("input",this.handleInput),this.restoreProgress(),this.autoSaveInterval=setInterval(this.saveProgress,3e4),window.addEventListener("beforeunload",(()=>{this.saveProgress()}))}handleInput(t){"password"!==t.target.type&&(this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout((()=>this.saveProgress()),1e3))}saveProgress(){const t={};this.form.querySelectorAll("input, select, textarea").forEach((e=>{if("submit"!==e.type&&"password"!==e.type)switch(e.type){case"checkbox":case"radio":e.checked&&(t[e.name]=e.value);break;case"file":break;default:e.value&&(t[e.name]=e.value)}}));try{localStorage.setItem(this.storageKey,JSON.stringify({timestamp:Date.now(),data:t,currentStep:this.form.getAttribute("data-form-step-index")||0})),this.form.dispatchEvent(new CustomEvent("formProgressSaved"))}catch(e){console.warn("Failed to save form progress:",e)}}restoreProgress(){try{const t=localStorage.getItem(this.storageKey);if(!t)return!1;const{data:e,timestamp:s,currentStep:r}=JSON.parse(t),a=864e5;return Date.now()-s>a?(this.clearSavedProgress(),!1):(Object.entries(e).forEach((([t,e])=>{this.form.querySelectorAll(`[name="${t}"]`).forEach((t=>{switch(t.type){case"checkbox":case"radio":t.checked=t.value===e;break;default:t.value=e}}))})),r&&this.form.dispatchEvent(new CustomEvent("restoreStep",{detail:{step:parseInt(r,10)}})),this.form.dispatchEvent(new CustomEvent("formProgressRestored",{detail:{timestamp:s}})),!0)}catch(t){return console.warn("Failed to restore form progress:",t),!1}}clearSavedProgress(){try{return localStorage.removeItem(this.storageKey),!0}catch(t){return console.warn("Failed to clear form progress:",t),!1}}destroy(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.saveTimeout&&clearTimeout(this.saveTimeout),this.form.removeEventListener("input",this.handleInput)}}class r{constructor(t){this.form=t}init(){this.form.hasAttribute("data-form-prefill")&&this.prefillFromQueryParams();const t=this.getQueryParam("step");t&&this.form.dispatchEvent(new CustomEvent("goToStep",{detail:{step:parseInt(t,10)-1}}))}getQueryParam(t){return new URLSearchParams(window.location.search).get(t)}prefillFromQueryParams(){this.form.querySelectorAll("[data-param]").forEach((t=>{const e=t.getAttribute("data-param"),s=this.getQueryParam(e);if(s){switch(t.type){case"checkbox":t.checked="true"===s.toLowerCase();break;case"radio":t.value===s&&(t.checked=!0);break;default:t.value=s}t.dispatchEvent(new Event("change",{bubbles:!0}))}}))}}class a{constructor(t){this.form=t,this.validationRules=new Map,this.customValidators=new Map,this.setupDefaultValidators()}setupDefaultValidators(){this.customValidators.set("required",(t=>({valid:t.trim().length>0,message:"This field is required"}))),this.customValidators.set("email",(t=>({valid:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),message:"Please enter a valid email address"}))),this.customValidators.set("phone",(t=>({valid:/^[\d\s\-+()]{7,}$/.test(t),message:"Please enter a valid phone number"}))),this.customValidators.set("minLength",((t,e)=>({valid:t.length>=e,message:`Must be at least ${e} characters`}))),this.customValidators.set("maxLength",((t,e)=>({valid:t.length<=e,message:`Must be no more than ${e} characters`}))),this.customValidators.set("pattern",((t,e)=>({valid:new RegExp(e).test(t),message:"Please match the requested format"})))}init(){this.setupFieldValidations(),this.setupValidationListeners()}setupFieldValidations(){this.form.querySelectorAll("[data-validate]").forEach((t=>{const e=t.getAttribute("data-validate").split(" ");this.validationRules.set(t,e)}))}setupValidationListeners(){this.form.querySelectorAll("input, select, textarea").forEach((t=>{this.validationRules.has(t)&&(t.addEventListener("blur",(()=>this.validateField(t))),t.addEventListener("input",(()=>{this.clearError(t)})))}))}validateField(t){const e=this.validationRules.get(t);if(!e)return!0;let s=!0,r="";for(const a of e){let e,i;a.includes(":")?[e,i]=a.split(":"):e=a;const o=this.customValidators.get(e);if(o){const e=o(t.value,i);if(!e.valid){s=!1,r=t.getAttribute("data-error-message")||e.message;break}}}return s?this.clearError(t):this.showError(t,r),s}validateStep(t){const e=t.querySelectorAll("input, select, textarea");let s=!0;return e.forEach((t=>{this.validationRules.has(t)&&(this.validateField(t)||(s=!1))})),s}validateAllSteps(){const t=this.form.querySelectorAll("[data-form-step]");let e=!0;return t.forEach((t=>{this.validateStep(t)||(e=!1)})),e}showError(t,e){t.setAttribute("data-invalid","");let s=t.parentElement.querySelector(".form-error-message");s||(s=document.createElement("div"),s.className="form-error-message",t.parentElement.appendChild(s)),s.textContent=e}clearError(t){t.removeAttribute("data-invalid");const e=t.parentElement.querySelector(".form-error-message");e&&e.remove()}clearAllErrors(){this.form.querySelectorAll("[data-invalid]").forEach((t=>{this.clearError(t)}))}addValidator(t,e){this.customValidators.set(t,e)}}class i{constructor(t){if(!(t instanceof Element))throw new Error("A form element must be passed to the constructor");this.form=t,this.stepManager=new e(this.form),this.formMemory=new s(this.form),this.queryParams=new r(this.form),this.validator=new a(this.form),this.steps=Array.from(this.form.querySelectorAll("[data-form-step]")),this.nextButtons=Array.from(this.form.querySelectorAll('[data-form-navigation="next"]')),this.prevButtons=Array.from(this.form.querySelectorAll('[data-form-navigation="prev"]')),this.currentStepIndex=0,this.init()}init(){this.validator.init(),"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.init(),this.queryParams.init(),this.updateStepStates(),this.nextButtons.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault(),this.nextStep()}))})),this.prevButtons.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault(),this.previousStep()}))})),this.updateNavigationState(),this.form.addEventListener("submit",(t=>this.handleSubmit(t))),this.setupEventListeners(),this.setupKeyboardNavigation()}setupEventListeners(){this.form.addEventListener("stepChange",(()=>this.updateNavigationState())),this.form.addEventListener("restoreStep",(t=>{this.goToStep(t.detail.step)})),this.form.addEventListener("goToStep",(t=>{this.goToStep(t.detail.step)})),"false"!==this.form.getAttribute("data-form-memory")&&this.form.addEventListener("formProgressSaved",(()=>{this.showSavedFeedback()}))}setupKeyboardNavigation(){this.form.addEventListener("keydown",(t=>{"true"===this.form.getAttribute("data-keyboard-nav")&&("Enter"!==t.key||t.shiftKey?"Enter"===t.key&&t.shiftKey&&(t.preventDefault(),this.previousStep()):(t.preventDefault(),this.nextStep()))}))}updateStepStates(){this.steps.forEach(((t,e)=>{if(t.removeAttribute("data-form-step-active"),t.removeAttribute("data-form-step-completed"),t.removeAttribute("data-form-step-upcoming"),e===this.currentStepIndex){t.setAttribute("data-form-step-active",""),t.style.display="block";const e=t.querySelector("input, select, textarea");e&&e.focus()}else e<this.currentStepIndex?(t.setAttribute("data-form-step-completed",""),t.style.display="none"):(t.setAttribute("data-form-step-upcoming",""),t.style.display="none")})),this.form.setAttribute("data-form-step-index",this.currentStepIndex),this.form.setAttribute("data-form-step-count",this.steps.length),"false"!==this.form.getAttribute("data-auto-scroll")&&this.form.scrollIntoView({behavior:"smooth",block:"start"})}updateNavigationState(){this.prevButtons.forEach((t=>{t.removeAttribute("data-navigation-disabled"),t.removeAttribute("data-navigation-hidden"),0===this.currentStepIndex?(t.setAttribute("data-navigation-disabled",""),t.disabled=!0):(t.removeAttribute("data-navigation-disabled"),t.disabled=!1)})),this.nextButtons.forEach((t=>{t.removeAttribute("data-navigation-disabled"),t.removeAttribute("data-navigation-hidden"),t.removeAttribute("data-navigation-final"),this.currentStepIndex===this.steps.length-1?(t.setAttribute("data-navigation-disabled",""),t.disabled=!0):this.currentStepIndex===this.steps.length-2?(t.setAttribute("data-navigation-final",""),t.disabled=!1):(t.removeAttribute("data-navigation-disabled"),t.disabled=!1)}))}nextStep(){const t=this.steps[this.currentStepIndex];this.validator.validateStep(t)&&this.currentStepIndex<this.steps.length-1&&(this.currentStepIndex++,this.updateStepStates(),this.updateNavigationState(),"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.saveProgress(),this.form.dispatchEvent(new CustomEvent("stepComplete",{detail:{step:this.currentStepIndex-1}})))}previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,this.updateStepStates(),this.updateNavigationState(),"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.saveProgress())}goToStep(t){if(t>=0&&t<this.steps.length){let e=!0;for(let s=0;s<t;s++)if(!this.validator.validateStep(this.steps[s])){e=!1,this.currentStepIndex=s;break}e&&(this.currentStepIndex=t),this.updateStepStates(),this.updateNavigationState()}}handleSubmit(t){if(this.currentStepIndex!==this.steps.length-1||!this.validator.validateAllSteps())return t.preventDefault(),void alert("Please complete all required fields correctly before submitting.");"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.clearSavedProgress(),this.form.dispatchEvent(new CustomEvent("formValid"))}resetForm(){this.form.reset(),this.validator.clearAllErrors(),"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.clearSavedProgress(),this.goToStep(0)}showSavedFeedback(){let t=this.form.querySelector(".form-save-indicator");t||(t=document.createElement("div"),t.className="form-save-indicator",this.form.appendChild(t)),t.textContent="Progress saved",t.style.opacity="1",setTimeout((()=>{t.style.opacity="0"}),2e3)}destroy(){"false"!==this.form.getAttribute("data-form-memory")&&this.formMemory.destroy(),this.nextButtons.forEach((t=>{t.removeEventListener("click",this.nextStep)})),this.prevButtons.forEach((t=>{t.removeEventListener("click",this.previousStep)})),this.form.removeEventListener("submit",this.handleSubmit),this.validator.clearAllErrors()}}class o{static init(){document.querySelectorAll("[data-multi-step-form]").forEach((t=>{t.id||(t.id=`msf-${Math.random().toString(36).substr(2,9)}`);const e=new i(t);t._multiStepForm=e}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>o.init())):o.init(),window.WebflowMultiStepForm={init:o.init,create:t=>new i(t)},t.WebflowMultiStepForm=i,t.default=o,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=webflow-multistep-form.umd.js.map
